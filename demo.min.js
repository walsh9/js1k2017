for(S=250,STAGE=0,T=I=-50,D=99,W=a.width,M=Math,R=M.random,l='length',cls=()=>a.width=W,$=(d)=>{for(c.font=S+'px x',c.fillText(d,0,S),im=c.getImageData(0,9,S,S),cls(),gs=[],i=im.data[l];i-=4;)[rc,gc,bc]=im.data.slice(i,i+3),gs[i/4]=0|M.min(255,M.max(0,296*M.pow(84e-5*rc+.003*gc+275e-6*bc,1/3)-42));for(gs.forEach((f,g)=>{opx=f,npx=128<f?255:0,qe=opx-npx,gs[g]=npx,[[1,0.44],[S-1,.19],[S,.31],[S+1,.06]].forEach((h)=>{g+h[0]<gs[l]&&(gs[g+h[0]]+=0|qe*h[1]+.5)})}),pt=[],i=gs[l];i--;)!gs[i]&&128<im.data[4*i+3]&&pt.push([i%S,0|i/S]);return pad(pt),pt},ct=(d,f)=>{return diff=d[l]-f[l],pad(0<diff?f:d,M.abs(diff)),d.map((g,h)=>[d[h][0],d[h][1],f[h][0],f[h][1]])},pad=(d,f)=>{for(;f--;)d.push(d[0|R()*d[l]]);d.map((g,h)=>d[(d[h]=d[j=0|h+R()*(d[l]-h)],j)]=g)},ani=(d,f)=>0|d+(f-d)*T/D,e=[...'\uD83D\uDD4A\uD83D\uDC4F\uD83D\uDC23\uD83C\uDFA9\uD83D\uDD2E'].map($),t=[],x=e[l]-1;x--;)t.push(ct(e[x+1],e[x]));t.push(ct(e[0],e[e[l]-1])),setInterval(()=>{T++,STAGE<e[l]?(cls(),document.bgColor='#eee',c.fillStyle='#333',c.font=S+'px serif',t[STAGE].forEach((f)=>{x=W/2-S/2,y=20,0<T?c.fillRect(ani(f[0],f[2])+x,ani(f[1],f[3])+y,1,1):c.fillRect(0|f[0]+x+R()+.5,0|f[1]+y+R()+.5,1,1)}),T>D&&(T=I,STAGE++)):(STAGE=0,T=I)},32);
