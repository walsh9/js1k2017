for(S=250,T=STAGE=0,W=a.width,H=a.height,M=Math,R=M.random,_='length',cls=()=>a.width=W,$=(d)=>{for(c.font=`${S}px serif`,c.textBaseline='top',c.fillText(d,0,0),im=c.getImageData(0,0,S,S),cls(),gs=[],i=im.data[_];i-=4;)[rc,gc,bc]=im.data.slice(i,i+3),lum=.21*rc/255+.72*gc/255+.07*bc/255,li=~~(255*((116*M.pow(lum,1/3)-16)/99)),gs[i/4]=li;for(gs.forEach((f,g)=>{opx=f,npx=128<f?255:0,qe=opx-npx,gs[g]=npx,ex=g%S,ey=~~(g/S),[[1,0,0.44],[-1,1,0.19],[0,1,0.31],[1,1,0.06]].forEach((h)=>{idx=ex+h[0]+(ey+h[1])*S,idx<gs[_]&&(gs[idx]+=0|qe*h[2]+.5)})}),pt=[],i=gs[_];i--;)!gs[i]&&128<im.data[4*i+3]&&pt.push([i%S,~~(i/S)]);return pad(pt),pt},ct=(d,f)=>{return diff=d[_]-f[_],pad(0<diff?f:d,M.abs(diff)),d.map((g,h)=>[d[h][0],d[h][1],f[h][0],f[h][1]])},pad=(d,f)=>{for(;f--;)d.push(d[~~(R()*d[_])]);d.map((g,h)=>d[(d[h]=d[j=0|h+R()*(d[_]-h)],j)]=g)},D=99,ani=(d,f)=>d+(f-d)*T/D,draw=(d,f=20,g=20)=>{cls(),c.fillStyle='#f0f',d.forEach((h)=>{c.fillRect(2*~~(ani(h[0],h[2])+f),2*~~(ani(h[1],h[3])+g),2,2)}),T>=D&&(T=-99,STAGE++)},e=[...'\uD83D\uDC7E\uD83D\uDD2E'].map($),t=[],len=e[_],x=len-1;x--;)t.push(ct(e[x+1],e[x]));t.push(ct(e[0],e[len-1])),setInterval(()=>{T++,STAGE<len&&0<T?draw(t[STAGE]):STAGE>=len&&(STAGE=0,T=-99)},32);
